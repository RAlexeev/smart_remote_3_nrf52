<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Smart Remote 3 nRF52 v1.2 : Enabling debug mode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Smart Remote 3 nRF52 v1.2
   </div>
  </td>
 </tr>
 </tbody>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s130","s132","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="usergroup0.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('debug_mode.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Enabling debug mode </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Smart Remote firmware can be built in debug or release mode. Debug mode is recommended for development, while release mode should be used for production. Debug mode can be turned on with <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga4658f7a42d0fd5a6b1e0c29e4cc39754">CONFIG_DEBUG_ENABLED</a>. By default, it is enabled on nRF52832 and disabled on nRF52810.</p>
<p>The following table summarizes the differences between these modes:</p>
<table class="doxtable">
<tr>
<th><b>Release mode</b> </th><th><b>Debug mode</b></th></tr>
<tr>
<td>Internal error detected by <a class="el" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c">APP_ERROR_CHECK()</a> causes a reset. If the logger is enabled, basic information about the error is printed. </td><td><a class="el" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c">APP_ERROR_CHECK()</a> halts the firmware. If the logger is enabled, extensive information about the error is printed. </td></tr>
<tr>
<td>Hard fault causes a reset. </td><td>Hard fault halts the firmware. </td></tr>
<tr>
<td>Error messages contain only error code. </td><td>Error messages contain the error code, file name, and line number. </td></tr>
<tr>
<td>Assertions are excluded from compilation. </td><td>Assertions are compiled in the firmware. </td></tr>
<tr>
<td>All debug utilities are disabled. </td><td>Debug utilities are compiled in, according to the configuration under the Debug Mode tree. </td></tr>
</table>
<p><a class="el" href="group__app__error.html#ga82d00a810dcea7dcc6af469461fb254c">APP_ERROR_CHECK</a> is a convenience macro for error validation.</p>
<p>If the logger is enabled, error information is printed out regardless of debug/release mode settings. The error information is more detailed when debug mode is enabled.</p>
<p>Debug mode requires a significant amount of space in flash memory. It can be disabled to provide space for other features.</p>
<h1><a class="anchor" id="debug_infrastructure"></a>
Debugging infrastructure</h1>
<p>Debug mode adds an infrastructure useful for development and debugging. Features available in debug mode:</p>
<ul>
<li><a class="el" href="debug_mode.html#debug_pins">Debug pins</a>,</li>
<li><a class="el" href="debug_mode.html#debug_event_monitor">Event Bus monitor</a>,</li>
<li><a class="el" href="debug_mode.html#debug_audio_probe">Audio Probe</a>,</li>
<li><a class="el" href="debug_mode.html#debug_stack_profiler">Stack usage profiler</a>,</li>
<li><a class="el" href="debug_mode.html#debug_jlink_monitor">J-Link Monitor mode</a>.</li>
</ul>
<p>Each of the mentioned features can be enabled or disabled separately in the configuration file.</p>
<div class="image">
<img src="sr3_debug_mode.png" alt="sr3_debug_mode.png"/>
<div class="caption">
Debug mode features</div></div>
<h1><a class="anchor" id="debug_pins"></a>
Debug pins</h1>
<p>Some events need to stick to a specific timing or happen too fast to be effectively observed with log messages. Debug pins make it possible to observe the timing of the events on an oscilloscope or a logic analyzer.</p>
<p><b>Error handling debug pins</b> send an error code, file name, and line number of the code where the error happened over an SPI-like transmission:</p>
<ul>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga2bddefd1973c554caa4f3b3d8f8540d6">CONFIG_IO_DBG_MARK</a> - asserted during transmission of the error.</li>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#gaf5600aa67185c1f28395702720418853">CONFIG_IO_DBG_CLOCK</a> - Serial Clock pin during error message transmission.</li>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga0a5aed8d92f8c90af496148ef3e4a50c">CONFIG_IO_DBG_DATA</a> - Serial Data pin during error message transmission.</li>
</ul>
<p><b>Audio debug pins</b> show the exact timing of audio processing.</p>
<ul>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga5c33ae22865f94cdde6ab784ed808622">CONFIG_IO_DBG_AUDIO_CAPTURE</a> - pulses when an audio buffer is passed from the PDM driver to audio processing.</li>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga015ed6aa65a0b61f6d2c2c602cefae22">CONFIG_IO_DBG_AUDIO_PROCESS</a> - set to high state during audio processing. If there is an error during audio processing, this pin stays in high state until the next audio buffer is processed.</li>
</ul>
<p><b>Sleep debug pin</b> <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga83871b8242d9bcd65772993b22fac8d1">CONFIG_IO_DBG_SLEEP</a> - set to high state when the device goes to sleep.</p>
<p><b>IR transmitter debug pins</b> are useful to observe the IR driver behavior.</p>
<ul>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga40ada649f4ece8ba30eb86bcdf65c1cc">CONFIG_IO_DBG_IR_TX_PWM_INT</a> - pulses in the beginning of a PWM interrupt handler driving the IR transmitter.</li>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga8e3ae42a90040261c65c716b3aee6f2d">CONFIG_IO_DBG_IR_TX_SACK</a> - pulses when IR "symbol acknowledge" is signaled.</li>
<li><a class="el" href="group__sr3__config__nrf52832__pca63519.html#gaf0e43a5b6d4e65476d109889be373224">CONFIG_IO_DBG_IR_TX_EACK</a> - pulses when IR "end acknowledge" is signaled.</li>
</ul>
<h1><a class="anchor" id="debug_event_monitor"></a>
Event Bus monitor</h1>
<p>With this option enabled, the Smart Remote firmware reports events that appear on the event bus. Event bus activity is displayed in the form of log messages.</p>
<p>It is possible to enable monitoring of the below event categories separately:</p>
<ul>
<li>system events,</li>
<li>keyboard events,</li>
<li>motion events,</li>
<li>HID events,</li>
<li>IR events,</li>
<li><em>Bluetooth</em> events.</li>
</ul>
<h1><a class="anchor" id="debug_audio_probe"></a>
Audio Probe</h1>
<p>Refer to <a class="el" href="audioprobe.html">Audio Probe</a>.</p>
<h1><a class="anchor" id="debug_stack_profiler"></a>
Stack usage profiler</h1>
<p>Stack usage profiler makes it possible to measure how much stack space is used by the application.</p>
<p>On system start, the profiler fills stack space with a marker. When the device goes to sleep, it is checked up to which point the markers were overwritten and the maximal stack usage is reported as a log message.</p>
<h1><a class="anchor" id="debug_jlink_monitor"></a>
J-Link Monitor mode</h1>
<p>Using the J-Link Monitor mode allows the CPU to service time-critical tasks when the application is halted on a breakpoint. As a result, the wireless BLE link can be maintained by the SoftDevice during a debugging session.</p>
<dl class="section note"><dt>Note</dt><dd>The J-Link driver requires a J-Link PLUS, ULTRA+, or PRO license to work in Monitor Mode. The nRF52 DK comes with built-in J-Link OB, which is lacking this feature. On Windows, the J-Link driver lets you evaluate the Monitor Mode with the nRF52 DK, while on Linux it is not possible.</dd></dl>
<p>To be able to debug in Monitor Mode, enable <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga90bfd97b6095631eeb0a5859e0f23321">CONFIG_JLINK_MONITOR_ENABLED</a> and compile the firmware.</p>
<dl class="section note"><dt>Note</dt><dd>When using Keil, remember to <b>Rebuild all target files</b> to make sure the Monitor Mode will be enabled.</dd></dl>
<p>Next, flash the firmware and start a debugging session.</p>
<p>To turn on Monitor Mode, open the J-Link control panel (on Windows, it can be found in the taskbar tray). After expanding the control panel downwards, it is possible to type commands.</p>
<div class="image">
<img src="debug_monitor_jlink_panel.png" alt="debug_monitor_jlink_panel.png"/>
<div class="caption">
Turning on Monitor Mode in J-Link control panel</div></div>
<p>Run the following commands: </p>
<div class="fragment"><div class="line">exec SetMonModeDebug=1</div>
<div class="line">exec SetMonModeVTableAddr=0x23000</div>
</div><!-- fragment --><p>The second command instructs the debugger where the application interrupt vector table resides in ROM memory. This depends on the SoftDevice version which is used. The table below illustrates the application interrupt vector table address for different Smart Remote 3 targets.</p>
<table class="doxtable">
<tr>
<th>Target processor </th><th>nRF52832 </th><th>nRF52810</th></tr>
<tr>
<td>SoftDevice version </td><td>S132 v5.1 </td><td>S112 v1.0 </td></tr>
<tr>
<td>Application interrupt vector table </td><td>0x23000 </td><td>0x18000 </td></tr>
</table>
<p>When you start debugging (run/step the application), J-Link lets you evaluate the Monitor Mode - click <code>Yes</code> in the pop-up window.</p>
<p>Now, it is possible to halt the application on breakpoints and step through the code without breaking the BLE connection.</p>
<dl class="section note"><dt>Note</dt><dd>In Monitor Mode, the SoftDevice can respond to connected devices, but the halted application has no way of responding to BLE events from the SoftDevice. This means that actions which require servicing by the application, such as bonding, may not be handled on time and will trigger a SoftDevice assertion. Assertion will also happen if the SoftDevice event queue overflows.</dd></dl>
<h2><a class="anchor" id="debug_monitor_rtt"></a>
Logging on RTT in Monitor Mode</h2>
<p>If you try to read RTT log messages in J-Link Monitor Mode, you will notice that they do not appear. This happens because the firmware starts logging on RTT only if the <code>CoreDebug-&gt;DHCSR</code> register indicates that there is a debugger connected. In Monitor Mode, the <code>CoreDebug-&gt;DHCSR</code> register is not set by debugger.</p>
<p>To use RTT logging during a Monitor Mode debug session, you can modify the condition </p>
<div class="fragment"><div class="line">(CoreDebug-&gt;DHCSR &amp; CoreDebug_DHCSR_C_DEBUGEN_Msk)</div>
</div><!-- fragment --><p> to </p>
<div class="fragment"><div class="line">1 || (CoreDebug-&gt;DHCSR &amp; CoreDebug_DHCSR_C_DEBUGEN_Msk)</div>
</div><!-- fragment --><p> in 3 places in the firmware: <code>main.c</code>, <code>nrf_cli_rtt.c</code>, and <code>app_error_handler.c</code>.</p>
<p>Remember to revert these changes after you are finished working in Monitor Mode.</p>
<dl class="section note"><dt>Note</dt><dd>An alternative to RTT is to use logging over UART. For UART, no changes are needed in Monitor Mode. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Thu Jun 7 2018" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
