<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Smart Remote 3 nRF52 v1.2 : Task management and latency minimization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Smart Remote 3 nRF52 v1.2
   </div>
  </td>
 </tr>
 </tbody>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s130","s132","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="usergroup0.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('task_management_latency_minimization.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Task management and latency minimization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Smart Remote uses a unique task management scheme to minimize the overall system latency, based on the one employed by the nRF5 SDK.</p>
<p>Because <em>Bluetooth</em> protocols require strict timing, the SoftDevice reserves top interrupt priorities for its exclusive usage to preempt the application when a protocol radio event has to be serviced. The table below presents interrupt priorities usage:</p>
<table class="doxtable">
<tr>
<th>Cortex-M4 Priority </th><th>Assignment </th><th>Usage in Smart Remote </th><th>Comment </th></tr>
<tr>
<td>0 </td><td>SoftDevice </td><td></td><td></td></tr>
<tr>
<td>1 </td><td>SoftDevice </td><td></td><td></td></tr>
<tr>
<td>2 </td><td>Application </td><td></td><td>No access to SoftDevice API </td></tr>
<tr>
<td>3 </td><td>Application </td><td></td><td>No access to SoftDevice API </td></tr>
<tr>
<td>4 </td><td>SoftDevice </td><td>Debug Monitor </td><td></td></tr>
<tr>
<td>5 </td><td>Application </td><td>Interrupt handlers </td><td></td></tr>
<tr>
<td>6 </td><td>Application </td><td>Foreground Scheduler </td><td></td></tr>
<tr>
<td>7 </td><td>Application </td><td>Background Scheduler </td><td></td></tr>
<tr>
<td>Thread </td><td>Application </td><td>Task Manager </td><td></td></tr>
</table>
<p>As shown in the table, a SoftDevice based application can use six out of nine interrupt priorities available on the nRF52 platform. It can call the SoftDevice API from only four of them.</p>
<p>To avoid blocking of a given priority, all interrupts that require heavy processing, like SoftDevice events, can be rescheduled using a dedicated scheduler library. In such case, the interrupt only generates an event that is put into the queue and processed later on a lower priority level.</p>
<p>Such approach allows for basic task priority management without using a real-time operating system. The low priority tasks can be rescheduled and thus preempted by high priority tasks running on higher priority levels. Moreover, special features of the nRF52 SoC, such as Software Interrupts and Event Generator Unit, can be used to leverage gain from such approach.</p>
<p>To avoid interrupt blocking, all data processing that is triggered by interrupts is rescheduled. However, most of the peripheral state management is still performed in interrupt context. As a result, data processing does not block peripheral operation. Also, because interrupt handling procedures are generally very short and straightforward, peripherals do not usually block one another, even if they are operating at the same interrupt priority level.</p>
<p>The nature of the Smart Remote application exhibits certain limitations of the nRF52 SDK single-scheduler approach. Voice data compression might take several milliseconds, during which no other data can be processed. This could lead to heavy jitter and latency of other types of user input, such as keyboard, air mouse, and touchpad.</p>
<p>To avoid this problem, Smart Remote uses two schedulers. The first one, called Foreground Scheduler, executes tasks at priority level 6. It preempts the second one, called Background Scheduler, which executes tasks at priority level 7.</p>
<p>The thread level is used by Task Manager, which handles the tasks that should not block any other activity: console, logger, as well as idle task.</p>
<p>The firmware schedules time-critical events (SoftDevice events, non-audio data processing) to the Foreground Scheduler, while it schedules others (for example, audio processing and compression) to the Background Scheduler.</p>
<p>Tasks executing from Foreground Scheduler together with the interrupts are estimated to take about 3% of the CPU load. This allows the system to remain responsive in any situation. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Thu Jun 7 2018" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
