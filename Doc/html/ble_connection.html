<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Smart Remote 3 nRF52 v1.2 : BLE connection management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Smart Remote 3 nRF52 v1.2
   </div>
  </td>
 </tr>
 </tbody>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s130","s132","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="usergroup0.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ble_connection.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">BLE connection management </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Once a <em>Bluetooth</em> connection is established, Smart Remote performs several actions in order to ensure secure and reliable operation.</p>
<h1><a class="anchor" id="ble_conn_security"></a>
Connection security</h1>
<p>In order to provide satisfactory level of security, the HID service is allowed to send data only over an encrypted link. As a result, link encryption must be performed as soon as possible in order to enable data flow.</p>
<p>Because Smart Remote is a <em>Bluetooth</em> peripheral device, it cannot enforce link security. After a connection from a bonded host, the remote waits for <a class="el" href="group__sr3__config__nrf52832__pca63519.html#gabaf81764f95298da6ca768d342a2f145">CONFIG_ENC_REQ_DELAY</a> miliseconds for an encryption request sent from the host. If during that time a link encryption procedure is not initiated, the remote sends its own request. If a secure link cannot be established, the remote disconnects and either starts advertising (if there is no bond stored or power management is disabled) or triggers a shutdown procedure.</p>
<h1><a class="anchor" id="ble_conn_parameters"></a>
Connection parameters negotiation</h1>
<p>Smart Remote implements <em>Bluetooth</em> connection parameters negotiation in order to obtain the most efficient link configuration. If the host chooses parameters different than the ones set in the Smart Remote configuration file (<a class="el" href="group__sr3__config__nrf52832__pca63519.html#gaa754f6eeb01a811bfe1cecd07f1d70ef">CONFIG_MIN_CONN_INTERVAL_MS</a>, <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga071d01c6df4ef25febfd119c61182988">CONFIG_MAX_CONN_INTERVAL_MS</a>, <a class="el" href="group__sr3__config__nrf52832__pca63519.html#gadf25c2c013431b86a7cfde41271c88da">CONFIG_SLAVE_LATENCY</a>, and <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga429c315db416530673ae449f51292145">CONFIG_CONN_SUP_TIMEOUT_MS</a>), the remote tries to renegotiate them. In such case, the first connection parameter update request is sent <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga46c8e65628be13263d428b5cf9528d8b">CONFIG_FIRST_CONN_PARAMS_UPDATE_DELAY</a> miliseconds after establishing the connection. If the negotiation is not successful, or the negotiated parameters are outside of the configured range, the remote waits <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga5353876b23844e2db69f3d769c827f6d">CONFIG_NEXT_CONN_PARAMS_UPDATE_DELAY</a> seconds and sends another connection parameter update request. The process repeats up to <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga3320b66f5749118cf06160eb211252ee">CONFIG_MAX_CONN_PARAMS_UPDATE_COUNT</a> times unless satisfactory parameters are negotiated.</p>
<h1><a class="anchor" id="ble_conn_phy_negotiation"></a>
PHY negotiation</h1>
<p>Smart Remote supports both 1 Mbit/s and 2 Mbit/s PHYs (accordingly with <em>Bluetooth</em> 5.0 specification). By default, the remote answers on PHY update request and advertises support for both rates. The fastest PHY supported by both the host and the remote is then used. The remote can also initiate PHY negotiation if <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga150142ab9fb7aeb23040042815ef37e1">CONFIG_PHY_SEND_UPDATE_REQUEST</a> option is set to 1. List of the available PHYs can be altered by respective options (<a class="el" href="group__sr3__config__nrf52832__pca63519.html#gaf414fa7d3fddbdfac3cea729f1ed6461">CONFIG_PHY_TX_1MBPS</a>, <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga9f60062fca15ec54728f1ba171a0540e">CONFIG_PHY_TX_2MBPS</a>, <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga12c6968504ccf6d78de1ce3df1b8701d">CONFIG_PHY_RX_1MBPS</a>, <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga6fab74d0eddc7487f45fe9789a78e5cf">CONFIG_PHY_RX_2MBPS</a>).</p>
<h1><a class="anchor" id="ble_conn_slave_latency_mgmt"></a>
Slave latency management</h1>
<p>In order to make negotiations described above as fast as possible, the remote temporarily disables slave latency. It is enabled back when link security is established (in case of connection with bonded host), or when all HID characteristics are enabled (in case of a first connection with the given host). Such approach minimizes the time needed to set up the <em>Bluetooth</em> link, allowing for fast bonding and reconnection. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Thu Jun 7 2018" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
