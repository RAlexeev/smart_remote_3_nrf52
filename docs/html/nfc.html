<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Smart Remote 3 nRF52 v1.2 : NFC pairing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Smart Remote 3 nRF52 v1.2
   </div>
  </td>
 </tr>
 </tbody>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s130","s132","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="usergroup0.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nfc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">NFC pairing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Smart Remote implements the NFC for the tap-to-pair functionality which allows the remote to instantly and securely pair with the host by touching it. You can also use the NFC module in a custom way to implement other NFC-based functionalities.</p>
<p>The tap-to-pair feature uses two modules:</p>
<ul>
<li><a class="el" href="group___m_o_d___n_f_c.html">Near Field Communication (NFC) module</a></li>
<li><a class="el" href="group___m_o_d___c_o_m_s___b_l_e___l_e_s_c.html">Low Energy Secure Connections (LESC) module</a></li>
</ul>
<p>Both these modules are based on libraries provided by the nRF5 SDK:</p>
<ul>
<li><a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v14.2.0/library_nfc.html" target="blank">NFC library and modules</a></li>
<li><a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v14.2.0/group__ecc.html" target="blank">Elliptic Curve Cryptography interface</a></li>
</ul>
<h1><a class="anchor" id="nfc_security"></a>
Security and authentication modes</h1>
<p>The security settings used in a connection depend on parameters negotiated during the exchange of pairing features.</p>
<p>From the NFC perspective, four security modes are supported:</p>
<ul>
<li>Authenticated LESC: In LESC authenticated mode, the initial link encryption is provided by public keys exchange and Elliptic Curve Diffie Hellman (ECDH) key generation. Authentication is provided by using Out-Of-Band (OOB) data for calculations in authentication checks.</li>
<li>Unauthenticated LESC: In LESC unauthenticated mode, link encryption is also provided by public keys exchange and ECDH key generation but authentication checks are skipped.</li>
<li>Authenticated LEGACY: In LEGACY authenticated mode, the initial link encryption is based on AES with a temporary key (TK) read from the NFC tag.</li>
<li>Unauthenticated LEGACY: In LEGACY unauthenticated mode, the TK has a default value of <code>0</code>.</li>
</ul>
<p>Smart Remote can support all of these four modes, depending on the configuration options that you select. Support for certain modes can be disabled by turning off configuration options, as discussed in <a class="el" href="nfc.html#nfc_config_flags">Setting configuration flags</a>.</p>
<h1><a class="anchor" id="security_setting"></a>
Setting security and authentication</h1>
<p>The actual security mode that will be used during the established connection depends on the flags that are sent during the Pairing Request/Response by both peers - the central device and Smart Remote.</p>
<h2><a class="anchor" id="lesc_legacy"></a>
LESC and Legacy modes</h2>
<p>LESC mode is used if both the central device and Smart Remote have the LESC flag set. Otherwise, the Legacy mode is used. The following matrix shows how LESC flags set on the peers affect the security mode used.</p>
<table class="doxtable">
<tr>
<th align="center">Central \ Smart Remote</th><th align="center">0</th><th align="center">1</th></tr>
<tr>
<td align="center">0 </td><td align="center">LEGACY</td><td align="center">LEGACY </td></tr>
<tr>
<td align="center">1 </td><td align="center">LEGACY</td><td align="center">LESC </td></tr>
</table>
<h2><a class="anchor" id="authentication_modes"></a>
Authentication in LESC and Legacy modes</h2>
<p>In LESC mode, the device which has read the peer's authentication data indicates this by setting the out-of-band (OOB) flag. Authentication check is then executed by the device which has set the OOB flag. However, because Smart Remote uses static Type 2 tag emulation, it does not have the capability to read the peer's data. Therefore, in LESC mode, the Smart Remote's OOB flag is reset. If in LESC mode both OOB flags are set to <code>0</code>, the authentication mode is determined by MITM and IOCAPS flags. The following matrix shows how OOB flags set on the peers affect the LESC authentication.</p>
<table class="doxtable">
<tr>
<th align="center">Central \ Smart Remote</th><th align="center">0</th><th align="center">1</th></tr>
<tr>
<td align="center">0 </td><td align="center">MITM and IOCAPS</td><td align="center">N/A </td></tr>
<tr>
<td align="center">1 </td><td align="center">OOB Authentication</td><td align="center">N/A </td></tr>
</table>
<p>In LEGACY mode, both Smart Remote and the central device have to set OOB flags for using the TK value available in NFC tag. Smart Remote sets the OOB flag when the TK value is present. The central device sets its OOB flag when the TK value has been read. The following matrix shows how OOB flags set on the peers affect the Legacy authentication.</p>
<table class="doxtable">
<tr>
<th align="center">Central \ Smart Remote</th><th align="center">0</th><th align="center">1</th></tr>
<tr>
<td align="center">0 </td><td align="center">MITM and IOCAPS</td><td align="center">MITM and IOCAPS </td></tr>
<tr>
<td align="center">1 </td><td align="center">MITM and IOCAPS</td><td align="center">OOB Authentication </td></tr>
</table>
<h2><a class="anchor" id="nfc_config_flags"></a>
Setting configuration flags</h2>
<p>The current tap-to-pair implementation for Smart Remote is development oriented. The functionality is also largely dependent on the central device. Therefore, Smart Remote attempts to negotiate the best security option by adapting the pairing response to the pairing request that comes from the central device.</p>
<div class="image">
<img src="config_flags_nfc.png" alt="config_flags_nfc.png"/>
<div class="caption">
Security options that affect the tap-to-pair functionality</div></div>
<p> The preferred mode is authenticated LESC. You must set these configuration options to enable this mode:</p>
<ul>
<li>Allow LESC Pairing</li>
<li>Enable NFC Tag</li>
</ul>
<p>If the <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga2cd67a28b21a041cc291f654c9cd52da">CONFIG_SEC_LESC_PAIRING</a> flag is off, and the <a class="el" href="group__sr3__config__nrf52832__pca63519.html#ga0f04227b34b53151d6afc6ef2651fa86">CONFIG_SEC_LEGACY_PAIRING</a> is enabled, Legacy encryption will be used. Both Legacy and LESC modes support OOB authentication.</p>
<p>When the <b>Provide Tap-to-Pair Tag</b> flag is enabled, Smart Remote generates OOB authentication data depending on the security mode used.</p>
<p>Additionally, keep in mind the following points when setting the configuration options:</p>
<ul>
<li>Options using OOB require the NFC module to be enabled.</li>
<li>When <a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v14.2.0/nfc_ndef_dox.html" target="blank">Full NDEF message</a> is enabled, both LE and EP records are included in Connection Handover. Otherwise, <a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v14.2.0/nfc_ndef_generation_dox.html" target="blank">only the LE record</a> is present. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Thu Jun 7 2018" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
