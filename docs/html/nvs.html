<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Smart Remote 3 nRF52 v1.2 : Nordic Voice System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Smart Remote 3 nRF52 v1.2
   </div>
  </td>
 </tr>
 </tbody>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s130","s132","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="usergroup0.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nvs.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Nordic Voice System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Nordic Voice System (NVS) is a set of components allowing to receive audio streams transmitted by the nRFready Smart Remote reference designs (nRFready Smart Remote 2, nRFready Smart Remote 3 for nRF51, and nRFready Smart Remote 3 for nRF52). NVS is tailored for the Ubuntu LTS 16.04 platform, enabling easy development and testing of the Smart Remote solution. However, its design allows for smooth porting to different environments.</p>
<p>This section provides an overview of NVS, as well as describes the principles of audio transmissions using the Smart Remote reference design.</p>
<h1><a class="anchor" id="VoHoG"></a>
Voice over HID over GATT</h1>
<p>The Smart Remote reference design traditionally uses Voice over HID over GATT (VoHoG) service for audio data transmission. The VoHoG service consists of two vendor-defined reports attached to the HID service already provided by the remote. There is one input report, which is used for audio data, as well as one output report acting as a control channel.</p>
<p>When audio streaming is started by sending an appropriate command (output report), the compressed audio data is sent over HID as vendor-defined reports. Format of the data is defined separately for each codec (and, in some cases, by its settings). However, the general principle is the same for all configurations: a large audio frame (dozens or hundreds of bytes) is divided into smaller reports, which are sent one by one and reassembled on the host side. If the link MTU is big enough and/or the audio frame is small, then a single audio frame can be sent using only one report.</p>
<h1><a class="anchor" id="nvs_for_linux"></a>
NVS for Linux</h1>
<p>NVS converts the received HID reports into an audio stream, performing audio frame reassembly, as well as decompression. These tasks are performed by a dedicated library, libnvs, which is the core component of NVS.</p>
<p>The libnvs library uses the hidraw interface (provided by Linux Kernel for every HID-compatible device registered in the system) to access the HID reports sent by the remote. Then, libnvs reads the HID report descriptor and selects the appropriate codec. When an audio stream is requested, libnvs sends a start command to the remote over the same hidraw interface and waits for data. The data is reassembled, decoded, and provided to the upper layers as a PCM stream. Similarly, when the stream is closed, a stop command is sent to the remote.</p>
<p>NVS also provides components allowing integration with the PulseAudio Sound Server used in Ubuntu. As a result, the remote is visible as a regular microphone in all applications that either directly or indirectly use the Ubuntu sound service. The connection is realized by two PulseAudio modules. The first module, module-nvs-source, implements PulseAudio NVS Source linking libnvs to the PulseAudio. The other module, module-nvs-detect, manages NVS sources based on the udev events generated when a HID device is added or removed.</p>
<div class="image">
<img src="NVS.svg" alt="NVS.svg"/>
<div class="caption">
NVS Architecture</div></div>
<p> Note that NVS communicates directly with the HID subsystem and is not aware of any change of the <em>Bluetooth</em> link state (the HID device is not removed by BlueZ when the remote disconnects). As a result, a potential state mismatch can occur between the host and the remote. Interrupted streams, caused by a disconnection or device reset, are not resumed until the NVS device is closed and opened again. Lastly, care must be taken when restarting an audio stream, as PulseAudio keeps the audio source active for some time after it was released. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Thu Jun 7 2018" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
